From: Zero King <l2dy@icloud.com>
Date: Fri, 25 May 2018 08:24:21 +0000
Subject: yaml: Add test for UTF-8 document

Cherry-picked from upstream commit 924e3203c69921dd4a25b43fa52c1db24202a157
---
 t/32-yaml.t             | 12 +++++++++++-
 t/data-32/yamlutf8.err  |  0
 t/data-32/yamlutf8.out  |  3 +++
 t/data-32/yamlutf8.po   | 22 ++++++++++++++++++++++
 t/data-32/yamlutf8.yaml |  3 +++
 5 files changed, 39 insertions(+), 1 deletion(-)
 create mode 100644 t/data-32/yamlutf8.err
 create mode 100644 t/data-32/yamlutf8.out
 create mode 100644 t/data-32/yamlutf8.po
 create mode 100644 t/data-32/yamlutf8.yaml

diff --git a/t/32-yaml.t b/t/32-yaml.t
index a88a78a..4b34caa 100644
--- a/t/32-yaml.t
+++ b/t/32-yaml.t
@@ -44,7 +44,17 @@ push @tests, {
     'doc' => "yamlkeysoption2 test"
 };
 
-use Test::More tests => 2 * 3;
+push @tests, {
+    'run' => "perl ../../po4a-normalize -f yaml ../data-32/yamlutf8.yaml -M UTF-8 >yamlutf8.err 2>&1".
+	     "&& mv po4a-normalize.po yamlutf8.po ".
+	     "&& mv po4a-normalize.output yamlutf8.out ",
+    'test'=> "perl ../compare-po.pl --no-ref ../data-32/yamlutf8.po yamlutf8.po ".
+             "&& diff -u ../data-32/yamlutf8.out yamlutf8.out 1>&2".
+	     "&& diff -u ../data-32/yamlutf8.err yamlutf8.err 1>&2",
+    'doc' => "yamlutf8 test"
+};
+
+use Test::More tests => 2 * 4;
 
 chdir "t/tmp" || die "Can't chdir to my test directory";
 
diff --git a/t/data-32/yamlutf8.err b/t/data-32/yamlutf8.err
new file mode 100644
index 0000000..e69de29
diff --git a/t/data-32/yamlutf8.out b/t/data-32/yamlutf8.out
new file mode 100644
index 0000000..444e273
--- /dev/null
+++ b/t/data-32/yamlutf8.out
@@ -0,0 +1,3 @@
+---
+meta:
+  lang: 日本語
diff --git a/t/data-32/yamlutf8.po b/t/data-32/yamlutf8.po
new file mode 100644
index 0000000..32cd370
--- /dev/null
+++ b/t/data-32/yamlutf8.po
@@ -0,0 +1,22 @@
+# SOME DESCRIPTIVE TITLE
+# Copyright (C) YEAR Free Software Foundation, Inc.
+# This file is distributed under the same license as the PACKAGE package.
+# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: PACKAGE VERSION\n"
+"POT-Creation-Date: 2018-05-25 08:00+0000\n"
+"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
+"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
+"Language-Team: LANGUAGE <LL@li.org>\n"
+"Language: \n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+
+#. type: Hash Value - Key: lang
+#, no-wrap
+msgid "日本語"
+msgstr ""
diff --git a/t/data-32/yamlutf8.yaml b/t/data-32/yamlutf8.yaml
new file mode 100644
index 0000000..444e273
--- /dev/null
+++ b/t/data-32/yamlutf8.yaml
@@ -0,0 +1,3 @@
+---
+meta:
+  lang: 日本語
